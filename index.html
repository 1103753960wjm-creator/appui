<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CozyClean v2.3 - ä¸ªäººä¸­å¿ƒä¼˜åŒ–ç‰ˆ</title>
    <!-- å¼•å…¥é«˜è´¨æ„Ÿå­—ä½“ -->
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@500;700&family=Patrick+Hand&family=Lora:ital,wght@0,400;0,600;1,400&family=Noto+Serif+SC:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* --- è§†è§‰ç³»ç»Ÿ v2.3 --- */
        :root {
            --bg-desk: #E0E0E0;
            --bg-paper: #FDFBF7;
            --bg-kraft: #E6D2B5;
            --text-primary: #5D4037;
            --text-secondary: #8D6E63;
            --accent-red: #B74141;
            --accent-green: #688F4E;
            --accent-tape: #F0E68C;
            --nav-bg: #F9F7F2;
        }

        body {
            background-color: var(--bg-desk);
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            font-family: 'Lora', 'Noto Serif SC', serif;
            background-image: radial-gradient(#ccc 1px, transparent 1px);
            background-size: 20px 20px;
        }

        /* --- æ‰‹æœºå¤–å£³ä»¿çœŸ --- */
        .mobile-frame {
            width: 390px;
            height: 844px; /* iPhone 14 å°ºå¯¸ */
            background-color: var(--bg-paper);
            border-radius: 50px;
            box-shadow: 
                0 0 0 12px #333,
                0 20px 50px rgba(0,0,0,0.3),
                inset 0 0 20px rgba(0,0,0,0.05);
            position: relative;
            overflow: hidden;
            color: var(--text-primary);
        }

        .notch {
            position: absolute; top: 12px; left: 50%; transform: translateX(-50%);
            width: 120px; height: 35px; background: #000; border-radius: 20px; z-index: 999;
            pointer-events: none;
        }

        .texture-overlay {
            position: absolute; inset: 0; pointer-events: none; z-index: 50;
            opacity: 0.6;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.08'/%3E%3C/svg%3E");
        }

        /* --- UI ç»„ä»¶æ ·å¼ --- */

        .hand-drawn-ring {
            stroke-dasharray: 283; 
            stroke-dashoffset: 283;
            transition: stroke-dashoffset 1s ease-out;
            filter: drop-shadow(2px 2px 2px rgba(0,0,0,0.1));
        }

        .washi-tape-bar {
            width: 80%; height: 12px;
            background: rgba(0,0,0,0.05);
            position: relative;
            margin: 10px auto;
            mask-image: url("data:image/svg+xml,%3Csvg width='200' height='20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 0 L200 0 L200 20 L0 20 Z' fill='black'/%3E%3C/svg%3E");
        }
        .washi-tape-fill {
            height: 100%; background: var(--accent-tape); width: 100%;
            opacity: 0.8;
            background-image: repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255,255,255,0.5) 5px, rgba(255,255,255,0.5) 10px);
            transition: width 0.5s;
        }

        /* æ¨¡å¼ç¥¨æ® */
        .mode-carousel {
            display: flex; gap: 15px; overflow-x: auto; padding: 10px 25px;
            scrollbar-width: none;
        }
        .mode-carousel::-webkit-scrollbar { display: none; }
        
        .mode-ticket {
            flex: 0 0 100px; height: 130px;
            background: #fff;
            border: 1px dashed #d1c4b0;
            border-radius: 8px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            position: relative;
            transition: all 0.2s;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.05);
        }
        .mode-ticket::before, .mode-ticket::after {
            content: ''; position: absolute; top: 50%; width: 12px; height: 12px; background: var(--bg-paper); border-radius: 50%;
        }
        .mode-ticket::before { left: -6px; } .mode-ticket::after { right: -6px; }

        .mode-ticket.active {
            background: #FFFDF5;
            border: 1px solid var(--accent-red);
            transform: translateY(-5px) rotate(-1deg);
            box-shadow: 0 8px 15px rgba(183, 65, 65, 0.15);
        }

        /* ç«æ¼†æŒ‰é’® */
        .wax-seal {
            width: 130px; height: 130px;
            background: radial-gradient(circle at 30% 30%, #D65A5A, #B74141, #8E3232);
            border-radius: 52% 48% 55% 45% / 45% 55% 45% 55%;
            box-shadow: 
                inset 5px 5px 15px rgba(255,255,255,0.2),
                inset -5px -5px 10px rgba(0,0,0,0.3),
                3px 8px 15px rgba(139, 50, 50, 0.4);
            display: flex; align-items: center; justify-content: center; flex-direction: column;
            cursor: pointer; position: relative;
            border: 4px solid rgba(0,0,0,0.05);
            transition: transform 0.1s;
        }
        .wax-seal:active { transform: scale(0.96); }
        .wax-seal::after {
            content: ''; position: absolute; inset: 12px;
            border: 2px solid rgba(255,255,255,0.2); border-radius: 50%; opacity: 0.5;
        }

        /* å¡ç‰‡æ ·å¼ */
        .card-polaroid {
            width: 300px; height: 420px;
            background: #fff;
            padding: 12px 12px 60px 12px;
            box-shadow: 0 10px 25px rgba(93, 64, 55, 0.15);
            transform-origin: 50% 120%;
            will-change: transform;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='p'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='1' numOctaves='1'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23p)' opacity='0.03'/%3E%3C/svg%3E");
        }
        
        .card-screenshot {
            width: 280px; height: 480px;
            background: #F4F4F4;
            box-shadow: 0 5px 10px rgba(0,0,0,0.1);
            border: 1px dashed #ccc;
        }
        .card-screenshot img { object-fit: contain; padding: 10px; }

        /* æ‚¬æµ®æ’¤é”€æ ‡ç­¾ */
        .undo-sticker {
            position: absolute; bottom: 100px; left: 24px;
            background: #EFE3C8;
            color: var(--text-primary);
            padding: 8px 20px 8px 25px;
            font-family: 'Patrick Hand';
            font-size: 1.1rem;
            transform: rotate(-3deg);
            box-shadow: 2px 2px 4px rgba(0,0,0,0.15);
            clip-path: polygon(0 0, 100% 0, 100% 100%, 0 100%, 5% 50%);
            cursor: pointer; transition: 0.2s;
            z-index: 60;
        }
        .undo-sticker:active { transform: rotate(-3deg) scale(0.95); }

        /* åº•éƒ¨å¯¼èˆª */
        .nav-bar {
            background: var(--nav-bg);
            height: 80px;
            padding-bottom: 20px;
            border-top: 1px solid rgba(0,0,0,0.05);
            display: flex; justify-content: space-around; align-items: center;
        }
        .nav-icon { opacity: 0.4; transition: 0.3s; }
        .nav-icon.active { opacity: 1; color: var(--accent-red); transform: translateY(-2px); }

        .hidden { display: none !important; }
        .fade-in { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* å°ç«  */
        .stamp-mark {
            position: absolute; 
            z-index: 50;
            opacity: 0; 
            pointer-events: none; 
            mix-blend-mode: multiply;
        }
    </style>
</head>
<body>

    <!-- æ‰‹æœºå¤–å£³ -->
    <div class="mobile-frame">
        <div class="notch"></div>
        <div class="texture-overlay"></div>
        
        <!-- çŠ¶æ€æ  -->
        <div class="flex justify-between px-6 pt-3 text-xs font-bold opacity-40 select-none relative z-10">
            <span>22:05</span>
            <div class="flex gap-1">
                <div class="w-4 h-2.5 bg-current rounded-sm"></div>
                <div class="w-0.5 h-1 bg-current rounded-sm mt-0.5"></div>
            </div>
        </div>

        <!-- App å†…å®¹ -->
        <div id="app-content" class="relative h-full flex flex-col pb-[80px]">
            
            <!-- 1. é¦–é¡µ -->
            <div id="page-home" class="flex-1 flex flex-col items-center pt-8 fade-in relative z-20">
                <div class="text-center mb-6">
                    <!-- ä¿®æ”¹ 2ï¼šä¸ªæ€§åŒ–é—®å€™è¯­ -->
                    <h1 class="text-2xl font-bold font-serif text-[#5D4037]">æ™šä¸Šå¥½ï¼Œæ—å°èˆ’</h1>
                    <p class="text-sm font-hand opacity-60">å‡†å¤‡å¥½æ•´ç†å›å¿†äº†å—ï¼Ÿ</p>
                </div>

                <!-- è¿›åº¦ç¯ -->
                <div class="relative w-40 h-40 mb-8">
                    <svg class="absolute inset-0 w-full h-full text-gray-200" viewBox="0 0 100 100">
                        <circle cx="50" cy="50" r="45" fill="none" stroke="currentColor" stroke-width="2" stroke-dasharray="5,5" />
                    </svg>
                    <svg class="absolute inset-0 w-full h-full text-[#B74141] transform -rotate-90" viewBox="0 0 100 100">
                        <circle id="progress-circle" class="hand-drawn-ring" cx="50" cy="50" r="45" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round" />
                    </svg>
                    <div class="absolute inset-0 flex flex-col items-center justify-center">
                        <span id="count-display" class="text-4xl font-hand font-bold text-[#5D4037]">0</span>
                        <span class="text-xs opacity-50 font-serif">/ 100</span>
                    </div>
                </div>

                <!-- æ¨¡å¼é€‰æ‹© -->
                <div class="w-full mb-6">
                    <div class="mode-carousel">
                        <div class="mode-ticket active" onclick="setMode('blitz', this)">
                            <div class="text-2xl mb-1">âš¡ï¸</div>
                            <div class="font-bold text-xs">é—ªç”µæˆ˜</div>
                            <div class="text-[9px] opacity-50 uppercase tracking-widest mt-1">Free</div>
                        </div>
                        <div class="mode-ticket" onclick="setMode('screenshot', this)">
                            <div class="text-2xl mb-1">âœ‚ï¸</div>
                            <div class="font-bold text-xs">æˆªå›¾ç²‰ç¢</div>
                            <div class="text-[9px] bg-black text-white px-1 rounded mt-1">PRO</div>
                        </div>
                        <div class="mode-ticket" onclick="setMode('timeline', this)">
                            <div class="text-2xl mb-1">â³</div>
                            <div class="font-bold text-xs">æ—¶å…‰æœº</div>
                            <div class="text-[9px] bg-black text-white px-1 rounded mt-1">PRO</div>
                        </div>
                    </div>
                </div>

                <!-- å¼€å§‹æŒ‰é’® -->
                <div id="start-btn" class="wax-seal group relative z-30 transition-transform">
                    <span class="text-white text-xl text-center leading-tight font-hand transform -rotate-6 drop-shadow-md">
                        å¼€å§‹<br><span class="text-sm">æ•´ç†</span>
                    </span>
                </div>

                <!-- ä½“åŠ›æ¡ -->
                <div class="w-full text-center mt-4">
                    <div class="washi-tape-bar">
                        <div id="energy-bar" class="washi-tape-fill"></div>
                    </div>
                    <span class="text-[10px] opacity-40 font-serif tracking-widest">ä»Šæ—¥ä½“åŠ›</span>
                </div>
            </div>

            <!-- 2. æ•´ç†ç•Œé¢ -->
            <div id="page-swiper" class="absolute inset-0 z-30 bg-[#FDFBF7] hidden flex-col items-center justify-center">
                <div class="absolute top-12 left-0 w-full px-6 flex justify-between items-center z-40 opacity-50">
                    <span onclick="goHome()" class="cursor-pointer text-sm font-serif">â† è¿”å›</span>
                    <span class="font-hand">é—ªç”µæˆ˜æ¨¡å¼</span>
                </div>

                <!-- æ’¤é”€æŒ‰é’® -->
                <div id="undo-btn" class="undo-sticker opacity-50 pointer-events-none">
                    â†º æ’¤é”€
                </div>

                <!-- å¡ç‰‡å †å  -->
                <div id="card-stack" class="relative w-full h-full flex items-center justify-center">
                    <!-- Cards injected via JS -->
                </div>

                <div id="guide-text" class="absolute bottom-6 w-full flex justify-center gap-12 font-hand text-lg opacity-40 pointer-events-none">
                    <span class="text-[#B74141]">ä¸¢å¼ƒ</span>
                    <span class="text-[#688F4E]">ä¿ç•™</span>
                </div>
            </div>

            <!-- 3. æˆ‘çš„é¡µé¢ -->
            <div id="page-profile" class="flex-1 hidden flex-col pt-12 px-6 fade-in relative z-20 overflow-y-auto">
                <div class="flex items-center gap-4 mb-8">
                    <div class="w-20 h-20 bg-white p-1 shadow-md transform -rotate-3" style="border-radius: 4px;">
                        <img src="https://images.unsplash.com/photo-1544168190-79c11c9e85ee?auto=format&fit=crop&w=200" class="w-full h-full object-cover grayscale-[0.2]">
                    </div>
                    <div>
                        <h2 class="text-2xl font-serif font-bold text-[#5D4037]">æ—å°èˆ’</h2>
                        <!-- ä¿®æ”¹ 1ï¼šä¼šå‘˜æ ‡è¯†å±•ç¤ºåœ¨åç§°ä¸‹æ–¹ -->
                        <div id="vip-badge-container" class="mt-2">
                            <span id="badge-free" class="inline-block text-[10px] bg-gray-200 text-gray-500 px-2 py-0.5 rounded-full">å…è´¹ç‰ˆ</span>
                            <span id="badge-pro" class="hidden inline-block text-[10px] bg-black text-[#F0E68C] px-2 py-0.5 rounded-full border border-[#F0E68C]">æ°¸ä¹…ä¼šå‘˜</span>
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-2 gap-4 mb-8">
                    <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-100 text-center">
                        <div class="text-xs opacity-50 font-serif">å·²é‡Šæ”¾ç©ºé—´</div>
                        <div class="text-2xl font-bold font-hand text-[#688F4E]">1.2 <span class="text-sm">GB</span></div>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-100 text-center">
                        <div class="text-xs opacity-50 font-serif">è¿ç»­æ‰“å¡</div>
                        <div class="text-2xl font-bold font-hand text-[#B74141]">12 <span class="text-sm">å¤©</span></div>
                    </div>
                </div>

                <!-- ä¿®æ”¹ 3ï¼šèœå•æ’åºä¸å†…å®¹è°ƒæ•´ -->
                <div class="space-y-4">
                    <div class="border-b border-dashed border-[#D2B48C] pb-2 flex justify-between font-hand text-lg cursor-pointer">
                        <span>å†å²æ—¥å¿—</span>
                        <span class="opacity-40">â†’</span>
                    </div>
                    <div class="border-b border-dashed border-[#D2B48C] pb-2 flex justify-between font-hand text-lg cursor-pointer" onclick="document.getElementById('paywall').classList.remove('hidden')">
                        <span>ä¼šå‘˜ä¸­å¿ƒ</span>
                        <span class="opacity-40">â†’</span>
                    </div>
                    <div class="border-b border-dashed border-[#D2B48C] pb-2 flex justify-between font-hand text-lg cursor-pointer">
                        <span>è®¾ç½®</span>
                        <span class="opacity-40">â†’</span>
                    </div>
                    <div class="border-b border-dashed border-[#D2B48C] pb-2 flex justify-between font-hand text-lg cursor-pointer">
                        <span>å…³äº</span>
                        <span class="opacity-40">â†’</span>
                    </div>
                </div>
            </div>

            <!-- ä»˜è´¹å¼¹çª— -->
            <div id="paywall" class="absolute inset-0 z-50 bg-black/50 backdrop-blur-sm hidden flex items-center justify-center p-6">
                <div class="bg-[#FFFBF0] w-full max-w-sm p-6 rounded-2xl shadow-2xl relative text-center">
                    <div class="text-4xl mb-2">ğŸ‘‘</div>
                    <h3 class="text-xl font-bold font-serif mb-2">å‡çº§ä¼šå‘˜</h3>
                    <p class="text-sm opacity-70 font-hand mb-6">è§£é”æ‰€æœ‰æ¨¡å¼ä¸æ— é™ä½“åŠ›ã€‚</p>
                    <button onclick="unlockPro()" class="w-full py-3 bg-[#5D4037] text-white rounded-xl font-bold shadow-lg mb-3">ç«‹å³è§£é”</button>
                    <button onclick="document.getElementById('paywall').classList.add('hidden')" class="text-xs opacity-50 underline">ä»¥åå†è¯´</button>
                </div>
            </div>

        </div> 

        <!-- åº•éƒ¨ Tab -->
        <nav class="absolute bottom-0 w-full nav-bar z-40">
            <div id="tab-home" class="nav-icon active flex flex-col items-center cursor-pointer" onclick="switchTab('home')">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                <span class="text-[10px] font-serif mt-1">æ•´ç†</span>
            </div>
            <div id="tab-me" class="nav-icon flex flex-col items-center cursor-pointer" onclick="switchTab('profile')">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                <span class="text-[10px] font-serif mt-1">æˆ‘çš„</span>
            </div>
        </nav>

    </div>

    <script>
        const state = {
            count: 0,
            limit: 100,
            isPro: false,
            mode: 'blitz',
            history: []
        };

        const photos = [
            { src: 'https://images.unsplash.com/photo-1519689680058-324335c77eba?auto=format&fit=crop&w=400&q=80', date: 'å®å®çš„ç¬¬ä¸€æ­¥', type: 'photo' },
            { src: 'https://images.unsplash.com/photo-1611162617474-5b21e879e113?auto=format&fit=crop&w=400&q=80', date: 'èŠå¤©è®°å½•æˆªå›¾', type: 'screenshot' },
            { src: 'https://images.unsplash.com/photo-1512917774080-9991f1c4c750?auto=format&fit=crop&w=400&q=80', date: 'æ™´æœ—çš„å‘¨æ—¥', type: 'photo' }
        ];

        function switchTab(tab) {
            document.getElementById('page-home').classList.add('hidden');
            document.getElementById('page-profile').classList.add('hidden');
            document.getElementById('page-swiper').classList.add('hidden');
            
            document.getElementById('tab-home').classList.remove('active');
            document.getElementById('tab-me').classList.remove('active');

            if(tab === 'home') {
                document.getElementById('page-home').classList.remove('hidden');
                document.getElementById('tab-home').classList.add('active');
            } else {
                document.getElementById('page-profile').classList.remove('hidden');
                document.getElementById('tab-me').classList.add('active');
            }
        }

        function setMode(mode, el) {
            if(mode !== 'blitz' && !state.isPro) {
                document.getElementById('paywall').classList.remove('hidden');
                return;
            }
            state.mode = mode;
            document.querySelectorAll('.mode-ticket').forEach(e => e.classList.remove('active'));
            el.classList.add('active');
        }

        function unlockPro() {
            state.isPro = true;
            document.getElementById('paywall').classList.add('hidden');
            // æ›´æ–°ä¼šå‘˜æ ‡è¯†
            document.getElementById('badge-free').classList.add('hidden');
            document.getElementById('badge-pro').classList.remove('hidden');
            alert("âœ¨ ä¼šå‘˜å·²è§£é”ï¼");
        }

        document.getElementById('start-btn').addEventListener('click', () => {
            document.getElementById('page-home').classList.add('hidden');
            document.getElementById('page-swiper').classList.remove('hidden');
            document.querySelector('.nav-bar').classList.add('hidden');
            initCards();
        });

        function goHome() {
            document.getElementById('page-swiper').classList.add('hidden');
            document.getElementById('page-home').classList.remove('hidden');
            document.querySelector('.nav-bar').classList.remove('hidden');
            updateDashboard();
        }

        function updateDashboard() {
            document.getElementById('count-display').innerText = state.count;
            const offset = 283 - (state.count / 100) * 283;
            document.getElementById('progress-circle').style.strokeDashoffset = offset;
            
            const energyPct = Math.max(0, 100 - state.count);
            document.getElementById('energy-bar').style.width = energyPct + '%';
        }

        function initCards() {
            const container = document.getElementById('card-stack');
            container.innerHTML = '';
            state.history = [];
            
            const sessionPhotos = [...photos, ...photos]; 
            
            sessionPhotos.forEach((p, i) => {
                if(state.mode === 'screenshot' && p.type !== 'screenshot') return;

                const card = document.createElement('div');
                card.className = `absolute top-1/2 left-1/2 flex flex-col items-center cursor-grab active:cursor-grabbing 
                    ${state.mode === 'screenshot' ? 'card-screenshot' : 'card-polaroid'}`;
                card.style.transform = `translate(-50%, -50%) rotate(${state.mode === 'screenshot' ? 0 : Math.random()*4-2}deg)`;
                card.style.zIndex = 100 - i;
                
                card.innerHTML = `
                    <div class="flex-1 w-full overflow-hidden relative ${state.mode === 'screenshot' ? '' : 'bg-gray-100'}">
                        <img src="${p.src}" class="w-full h-full ${state.mode === 'screenshot' ? 'object-contain' : 'object-cover'} pointer-events-none">
                    </div>
                    ${state.mode === 'screenshot' ? '' : `<div class="py-4 font-hand text-xl opacity-70">${p.date}</div>`}
                    
                    <div class="stamp-mark top-12 right-8 transform -rotate-12 border-4 border-[#B74141] text-[#B74141] p-2 rounded font-hand font-bold text-xl opacity-0 stamp-del">
                        DISCARD
                    </div>
                    <div class="stamp-mark bottom-20 left-8 transform rotate-12 border-4 border-[#688F4E] text-[#688F4E] p-2 rounded-full font-hand font-bold text-xl opacity-0 stamp-keep">
                        KEEP
                    </div>
                `;

                container.appendChild(card);
                if(i === 0) setupSwipe(card);
            });

            if(container.children.length === 0) {
                alert("æ­¤æ¨¡å¼ä¸‹æš‚æ— ç…§ç‰‡ï¼");
                goHome();
            }
        }

        function setupSwipe(card) {
            let startX = 0, currentX = 0, isDragging = false;
            const threshold = 100;
            const sDel = card.querySelector('.stamp-del');
            const sKeep = card.querySelector('.stamp-keep');

            const start = (x) => { isDragging = true; startX = x; card.style.transition = 'none'; };
            
            const move = (x) => {
                if(!isDragging) return;
                currentX = x - startX;
                const rot = currentX * 0.1;
                card.style.transform = `translate(calc(-50% + ${currentX}px), -50%) rotate(${rot}deg)`;
                
                if(currentX < 0) {
                    sDel.style.opacity = Math.min(-currentX/threshold, 1);
                    sKeep.style.opacity = 0;
                } else {
                    sKeep.style.opacity = Math.min(currentX/threshold, 1);
                    sDel.style.opacity = 0;
                }
            };

            const end = () => {
                if(!isDragging) return; isDragging = false;
                if(Math.abs(currentX) > threshold) {
                    const isDel = currentX < 0;
                    card.style.transition = 'transform 0.4s ease-out';
                    card.style.transform = `translate(calc(-50% + ${isDel ? -500 : 500}px), -50%) rotate(${isDel ? -45 : 45}deg)`;
                    
                    if(isDel) state.count++;
                    
                    state.history.push({ card: card.cloneNode(true), isDel });
                    document.getElementById('undo-btn').classList.remove('opacity-50', 'pointer-events-none');

                    setTimeout(() => {
                        card.remove();
                        const nextCard = document.getElementById('card-stack').firstElementChild;
                        if(nextCard) setupSwipe(nextCard);
                        else {
                            alert("æœ¬æ¬¡æ•´ç†å®Œæˆï¼");
                            goHome();
                        }
                    }, 300);
                } else {
                    card.style.transition = 'transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
                    card.style.transform = `translate(-50%, -50%) rotate(0deg)`;
                    sDel.style.opacity = 0; sKeep.style.opacity = 0;
                }
            };

            card.addEventListener('touchstart', e => start(e.touches[0].clientX));
            window.addEventListener('touchmove', e => move(e.touches[0].clientX));
            window.addEventListener('touchend', end);
            
            card.addEventListener('mousedown', e => start(e.clientX));
            window.addEventListener('mousemove', e => move(e.clientX));
            window.addEventListener('mouseup', end);
        }

        document.getElementById('undo-btn').addEventListener('click', () => {
            if(state.history.length === 0) return;
            const last = state.history.pop();
            const container = document.getElementById('card-stack');
            
            if(last.isDel) state.count--;
            
            const card = last.card;
            card.style.transition = 'none';
            card.style.transform = `translate(calc(-50% + ${last.isDel ? -500 : 500}px), -50%) rotate(0deg)`;
            container.insertBefore(card, container.firstChild);
            
            requestAnimationFrame(() => {
                requestAnimationFrame(() => {
                    card.style.transition = 'transform 0.4s ease-out';
                    card.style.transform = `translate(-50%, -50%) rotate(0deg)`;
                });
            });

            setupSwipe(card);

            if(state.history.length === 0) {
                document.getElementById('undo-btn').classList.add('opacity-50', 'pointer-events-none');
            }
        });

    </script>
</body>
</html>
